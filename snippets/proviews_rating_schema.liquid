{% comment %} This file is automatically updated By Proviews. Please do not edit this file. {% endcomment %}
{% if shop.metafields.proviews.aggregateRatingSchema == "product"%}
  {% assign prorw_gtin_num = product.selected_or_first_available_variant.barcode | size %}
  {% assign prorw_featured_image = "" %}
  {% if product.featured_image %}   
    {% assign prorw_featured_image = product.featured_image | product_img_url: 'grande' | prepend  : "https:"  %}
  {% endif %}
  <script type="application/ld+json">
  {
    "@context":"http://schema.org",
    "@type":"Product",
    "@id":"{{ shop.url }}{{ product.url}}", 
    "productId": "{{ product.id }}",
    "name": {{ product.title | json }},
    "description": {{ product.description | strip_html | truncatewords: 50 | json }},
    "sku": {{ product.selected_or_first_available_variant.sku | json }},
    "url": {{ canonical_url | json }},
    "image": "{{ prorw_featured_image }}",
    {% if prorw_gtin_num == 12 or prorw_gtin_num == 13 or prorw_gtin_num == 14  %}
    "gtin{{prorw_gtin_num}}":"{{ product.selected_or_first_available_variant.barcode }}",
    {% endif %}
    "brand": {
      "@type": "Brand",
      "name": {{ product.vendor | json }},
      "url": {{ jsonld_brand_url | json }}
    },
    {% if product.metafields.proviews.totalReviewCount != blank and product.metafields.proviews.totalReviewCount != "0" %}
    "aggregateRating": [{
      "@type": "AggregateRating",
      "ratingValue": "{{ product.metafields.proviews.averageRatings }}",
      "reviewCount": "{{ product.metafields.proviews.totalReviewCount }}",
      "bestRating": "5",
      "worstRating": "1"
    }],
    "review":[{
      "@type": "Review",
      "itemReviewed":[{
        "@type": "Thing",
        "name": {{ product.title | json }},
        "image": "{{ prorw_featured_image }}",
        "datePublished": "{{ product.metafields.proviews.created_at }}"
      }],
      "author": [{
        "@type": "Person",
        "name": {{ shop.name | json }}
      }],
      "reviewRating": [{
        "@type": "Rating",
        "ratingValue": "{{ product.metafields.proviews.averageRatings }}",
        "bestRating": "5",
        "worstRating": "1"
      }]
    }],
    {% endif %}
    "offers": [{
      "@type": "Offer",
      "priceCurrency": "{{ shop.currency }}",
      "price": "{{ product.selected_or_first_available_variant.price | money_without_currency | remove: ',' }}",
      "priceValidUntil": "{{ "today" | date: '%s' | plus: days | date: "%Y-%m-%d" }}",
      "availability": "{% if product.selected_or_first_available_variant.available %}InStock{% else %}OutOfStock{% endif %}",
      "itemCondition": "http://schema.org/NewCondition",
      "seller": "{{ shop.name | escape }}",
      "url": "{{ shop.secure_url }}{{ product.selected_or_first_available_variant.url }}"
    }]  
  }
  </script>
{% endif %}

{% assign prorw_featured_image = "" %}
{% if shop.metafields.proviews.aggregateRatingSchema == "aggregate" %}
  {% if product.featured_image %}
    {% assign prorw_featured_image = product.featured_image | product_img_url: 'grande' | prepend  : "https:"  %}
  {% endif %}  
  {% if product.metafields.proviews.totalReviewCount != blank and product.metafields.proviews.totalReviewCount != "0" %}
  <script type="application/ld+json">  
  {
    "aggregateRating": [{
      "@type": "AggregateRating",
      "ratingValue": "{{ product.metafields.proviews.averageRatings }}",
      "reviewCount": "{{ product.metafields.proviews.totalReviewCount }}",
      "bestRating": "5",
      "worstRating": "1"
    }],
    "review":[{
      "@type": "Review",
      "itemReviewed":[{
        "@type": "Thing",
        "name": {{ product.title | json }},
        "image": "{{ prorw_featured_image }}",
        "datePublished": "{{ product.metafields.proviews.created_at }}"
      }],
      "author": [{
        "@type": "Person",
        "name": {{ shop.name | json }}
      }],
      "reviewRating": [{
        "@type": "Rating",
        "ratingValue": "{{ product.metafields.proviews.averageRatings }}",
        "bestRating": "5",
        "worstRating": "1"
      }]
    }]
  }
  </script>
  {% endif %}  
{% endif %}
